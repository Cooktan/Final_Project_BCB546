---
title: "Lab 7"
author: "Hunter Blum, Eric Steyer, Nichelle'Le Carrington, Yu-Ru Chen"
date: "10/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(plyr)
library(tidyverse)

race100<- read.csv("race100k.csv")

towns <- read.csv("towns2.csv")
```


# Pre-Exercise
```{r}
p1<-dim(race100)[2]
n<- dim(race100)[1]
p<-p1-1

races<- scale(race100, center = T, scale = T)
choose<-c(1,2,6,10,11)

par(pch=5)
pairs(race100[,choose], labels=c("0-10k time","10-20k time","50-60k time", "90-100k time","age"), 
      panel=function(x,y){panel.smooth(x,y)
        abline(lsfit(x,y), lty=2) })

race.pc <- prcomp(race100[,-p1])
race.pc$sdev

racecor <- var(races)
racecor

races.pcor <- prcomp(racecor[,-p1])
races.pcor$dev
races.pcor$rotation
summary(races.pcor)

plot(races.pcor$sdev^2, xlab="Component Number", ylab="Component Variance (eigenvalue)", main="Scree Diagram", type="l")

race.type <-rep("M",n)   
race.type[race100[ ,p1]>=40] <- "S"   
race.col <- rep("red",n)   
race.col[race100[ ,p1]>=40] <- "blue"

plot(race.pc$x[,1],race.pc$x[,2],          
xlab="P1: Overall speed",          
ylab="PC2: Change in speed",type="n")
text(race.pc$x[,1],race.pc$x[,2],labels=race.type, cex=0.9, col=race.col)


#Data on Ames Livability

towns$ames <- 0 
towns$ames[towns$Score==602]<- 1
```



#Exercise 1: Examine how the ten ratings variables are correlated with livability scores. 

Climate and economic ratings do not have a strong relationship with livability score. We found that diversions and education had a positive linear relationship with the livability scores. House rating has a slightly negative linear relationship, while community and health have a positive linear relationship with livability scores. Safety appears to have no relationship with livability. Transportation has a moderate positive linear relationship with livability while urban ratings appear to have no relationship. 
```{r}
layout(matrix(1:4, nrow=2, ncol=2))
plot(Score ~ Climate, data=towns, pch=1)
plot(Score ~ Diversions, data=towns, pch=1)
plot(Score ~ Economic, data=towns, pch=1)
plot(Score ~ Education, data=towns, pch=1)

plot(Score ~ Community, data=towns, pch=1)
plot(Score ~ Health, data=towns, pch=1)
plot(Score ~ House, data=towns, pch=1)
plot(Score ~ Safety, data=towns, pch=1)


plot(Score ~ Transportation, data=towns, pch=1)
plot(Score ~ Urban, data=towns, pch=1)
layout(matrix(1:1, nrow=1, ncol=1))

cor(towns$Score, towns[ ,4:13])
```


#Exercise 2

We must standardize the data because even though they are all on the same 0-100 scale, they have different variances (see boxplot) that we must standardize for. This will also ensure that all of the variables have the same weights when we calculate the PCA. 
```{r}
library(GGally)

ggpairs(towns[,c(4:8, 14)])

ggpairs(towns[,c(8:14)])

boxplot(towns[,4:13])
```


#Exercise 3

 Part A
  We need 6 PCs to explain 80% of the total variation as shown in the        cumulative proportion of our PCA.
  
  Part B
  We add the proportion of variance for every component. 

```{r}
# Part A
p1<-dim(towns)[2]   
n<-dim(towns)[1]  
p<-p1-1

town2<-scale(towns[,3:13], center=T, scale=T)

town.pc <- prcomp(town2)   
town.pc$sdev

plot(town.pc$sdev^2, xlab="Component Number", ylab="Component Variance (eigenvalue)",main="Scree Diagram", type="l")

# Part B
towns.pca <- prcomp(towns[,3:13], scale=T, retx = T)
summary(towns.pca)


```

#Exercise 4
a) Climate and house have positive contribution to the first PC, while the rest of the negative variables have negative contributions. For the second PC population, climate, education, safety, and transportation have positive contribution, however the other variables have negative contribution. 

b) Based on the fourth PC still having 8.2 percent of the variance and having a cumulative proportion of 67.1% we chose to have seven PCs. The scree plot flattens off after the fourth component indicating that we should use the first four components. 

#Exercise 5

There is a strong, positive linear relationship between the score variable and the scores for our first principal component, however there is the possibility of a high variance. Albemarle, NC is the city that is rated first based on the first principal component while Mount Vernon, WA was the top rated town based on the score variable. The two approaches appear to give similar ratings between the cities based on our plot. 

```{r}
head(rownames(towns)[order(towns$Score, decreasing=T)])

head(rownames(towns)[order(towns.pca$x[,1], decreasing=T)])

qplot(towns$Score, -towns.pca$x[,1], col=towns$ames) + theme_bw() + theme(aspect.ratio=1)

```
